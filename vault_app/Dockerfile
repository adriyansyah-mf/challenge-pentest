FROM python:3.8-slim

WORKDIR /app

COPY . .

# Install dependencies
RUN apt-get update && apt-get install -y sudo nano

# Set root password secara langsung
RUN echo 'root:rootpassword' | chpasswd

# Tambahkan user non-root
RUN useradd -m vaultuser

# Konfigurasi sudo untuk user vaultuser (tanpa password)
RUN echo 'vaultuser ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers

# Install Flask
RUN pip install Flask

# Set user ke non-root
USER vaultuser

CMD ["python", "app.py"]
